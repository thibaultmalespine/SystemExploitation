#!/bin/bash
if [ -e $1 ] && [ -f $1 ]
then
    if [ -e ~/SystemExploitation/.poubelle ]
    then
        echo répertoire .poubelle existant
    else
        mkdir ~/SystemExploitation/.poubelle
        echo répertoire .poubelle créer
    fi
    if [ -e ~/SystemExploitation/.poubelle-util/INDEX ]
    then
        echo fichier .poubelle-util/INDEX existant
    else
        touch ~/SystemExploitation/.poubelle-util/INDEX
        echo fichier .poubelle-util/INDEX créer
    fi

    fichiersDel=$(cat ~/SystemExploitation/.poubelle-util/INDEX)
    pathfile=$(readlink -f $1)

    isInIndex=false

    for fichier in $fichiersDel
    do
        if [[ $fichier == $pathfile ]]
        isInIndex=true
        then
            echo le fichier existe déjà dans la poubelle
            echo Souhaiter vous remplacer le fichier $fichier ? y/n ?
            read response
            if [ $response == "y" ]
            then
                fichier=~/SystemExploitation/.poubelle-util/INDEX
                echo chemin du fichier modifier dans INDEX
                mv $1 ~/SystemExploitation/.poubelle
                echo fichier déplacer vers la poubelle
            else  
                echo suppression annuler 
            fi
        fi
    done
    if [ $isInIndex == false ]
    then 
        echo $pathfile >>~/SystemExploitation/.poubelle-util/INDEX
        echo chemin du fichier ajouter à INDEX
        mv $1 ~/SystemExploitation/.poubelle
        echo fichier déplacer vers la poubelle
    fi

fi
